---
title: "Explore Scenarios: Ecotourism"
output:
  pdf_document:
    number_sections: yes
    toc: yes
    toc_depth: 3
  html_document:
    toc: yes
    toc_depth: '4'
    df_print: paged
editor_options:
  chunk_output_type: console
---

```{r setup, include=F, message=F, warning=F}
library(tidyverse)
library(sf)
library(paletteer)
library(colorspace)
library(grDevices)

# Load source
source(file.path(here::here(), "src", "common.R"))

# Shapefiles
ci_shp <- st_read(file.path(project_data_path, "processed", "spatial", "channel_islands.shp"))
mpa_shp <- st_read(file.path(project_data_path, "processed", "spatial", "north_channel_islands_mpas.shp"))

# Data 
dive_sites <- read_csv(file.path(project_data_path, "processed", "dive_sites_1hr30min_1vessel_labeled.csv"))
ais_dives <- read_csv(file.path(project_data_path, "processed", "ais-dives", "all_ais_dives_2016_november_2022_500m.csv"))
scenario1  <- read_csv(file.path(project_data_path, "processed", "ais-dives", "subset_north_max5hr_daytime_500m.csv"))
```

## Overview 

This document includes interactive maps and some exploratory graphs for 3 different subsets of the AIS-identified dive data. These subsets reflect 3 different "ecotourism" scenarios (i.e. focused on typical dive behavior that is not related to hunting activities). All data examined is focused on the Northern Channel Islands, with the following additional filters:   

  - Scenario 1 All daytime dives: Time spent at dive sites is between 1.5 - 5 hours; the first AIS timestamp within the site is between 6 am - 6 pm   
  - Scenario 2 Daytime without October: Further filters the scenario 1 dataset to remove any dives in the month of October (start of lobster season)    
  - Scenario 3 Daytime without lobster season: Further filters the scenario 1 to remove any dives during lobster season   

Scenario 3: Lobster season dates 

The official lobster season is the Saturday before the first Wednesday in October through the Wednesday immediately after March 15th. The specific dates vary by year so data are filtered according to the dates of lobster season in that year. 

  - 2015/2016 season: October 3rd - March 16th   
  - 2016/2017 season: October 1st - March 15th     
  - 2017/2018 season: September 30th - March 21st   
  - 2018/2019 season: September 29th - March 20th   
  - 2019/2020 season: September 28th - March 18th 
  - 2020/2021 season: October 3rd - March 17th      
  - 2021/2022 season: October 2nd - March 16th   
  - 2022/2023 season: October 1st - March 15th (data go through November 2022 so all October and November data are removed)   
  
```{r scenarios, message=F, warning=F, include=F}
# Define lobster season
lobster_season <- data.frame(start_year = c(2016:2022),
                             start_date = c('2016-10-01', '2017-09-30', '2018-09-29', '2019-09-28',
                                            '2020-10-03', '2021-10-02', '2022-10-01'),
                             end_year = c(2016:2022),
                             end_date = c('2016-03-16', '2017-03-15', '2018-03-21', '2019-03-20', 
                                          '2020-03-18', '2021-03-17', '2022-03-16'))

# Create other subsets of data from scenario 1
scenario2 <- scenario1 %>% 
  left_join(lobster_season %>% 
              dplyr::select(start_year, start_date), by = c('year' = 'start_year')) %>%
  mutate(end_date = paste(year, "10", "31", sep = "-")) %>% 
  # label which days to remove 
  mutate(rm = case_when(year %in% c(2020, 2021, 2022) & date >= start_date & date <= end_date ~ "yes",
                        year %in% c(2016,2017,2018,2019) & month == 10 ~ "yes",
                        TRUE ~ "no")) %>% 
  filter(rm == 'no') %>% 
  dplyr::select(-start_date, -end_date, -rm)
  


scenario3 <- scenario1 %>% 
  left_join(lobster_season %>% 
              dplyr::select(start_year, start_date), by = c('year' = 'start_year')) %>% 
  left_join(lobster_season %>% 
              dplyr::select(end_year, end_date), by = c('year' = 'end_year')) %>% 
  # Filter out from start date through December 31 of same year
  filter(date <= start_date) %>% 
  # Filter out from January 1st to end date 
  filter(date >= end_date)

## Save Scenario 2 for habitat selection model 
# Marine Reserve and Conservation Areas 
scen2_save <- scenario2 %>% 
  filter(mpa_definition == 'Marine Reserves & Conservation Areas')

write_csv(scen2_save, file.path(project_data_path, "ais-dives-data-share", "ais_ecotourism_dives_north_ci.csv"))
```

## Interactive Map

**NOTE: The map below is interactive and was built for web viewing so it can't be rendered in PDF form. The map simply displayed the locations of the dives for each of the 3 scenarios as well as the outline of MPA boundaries and MPA types (Reserves v. Conservation Areas) in a way that can be zoomed in and out across the different islands.**  

Map of the Northern Channel Island MPAs and possible dive sites. The map includes the following layers:  

  - `mpa_outline`: outline of MPA boundaries  
  - `mpa_type`: type of MPA (e.g., Marine Reserve or Conservation Area)   
  - `dive_sites`: possible dive sites identified through AIS (e.g., all sites where a vessel remained stationary for at least 90 minutes)  
    - There are 1,440 possible dive sites identified in the Northern Channel Islands  
  - `scenario1`: subset of dives matching Scenario 1 described above (3,537 dives)   
  - `scenario2`: subset of dives matching Scenario 2 described above (no October data; 3,012 dives)   
  - `scenario3`: subset of dives matching Scenario 3 described above (no lobster season data; 2,333 dives)   
  
Click the layers in the upper right hand corner to add layers to the map. Hover over MPAs in the `mpa_type` layer for MPA names, and over the dots in the `scenario` layers for more information about that dive (e.g., scenario, date, time of day). The `dive_sites` and the three `scenario` layers are clustered, zooming in on the map with uncluster them and reveal more of the detailed information.  

<br>  

```{r leaflet, warning=F, message=F, include=F}
# library(leaflet)
# library(leaflet.providers)
# library(htmltools)

# Northern Channel Islands
north_ci <- ci_shp %>% 
  filter(poly_id %in% c('San Miguel', 'Santa Rosa', 'Santa Cruz', 'Anacapa'))

mpa_shp <- mpa_shp %>% 
  mutate(mpa_type = factor(mpa_type, levels = c("Federal Marine Conservation Area", "Federal Marine Reserve",
                                                "State Marine Reserve", "State Marine Conservation Area")))

# North dive sites
north_sites <- dive_sites %>% 
  filter(island_group == "Northern") %>% 
  rename(x=lon_bin,
         y=lat_bin) %>% 
  left_join(ais_dives %>% 
              dplyr::select(site_id, site_frequency) %>% 
              distinct(), by = "site_id")

# AIS dives for one of two MPA scenarios 
scenario1_dives <- scenario1 %>% 
  filter(mpa_definition == "Marine Reserve") %>% 
  # Create a factor from site frequency 
  mutate(site_frequency = factor(site_frequency, levels = c('high', 'medium', 'low')),
         scenario = "Scenario 1") %>% 
  mutate(scenario = factor(scenario, levels = c("Scenario 1", "Scenario 2", "Scenario 3"))) %>% 
  rename(x=lon_bin,
         y=lat_bin)

scenario2_dives <- scenario2 %>% 
  filter(mpa_definition == "Marine Reserve") %>% 
  # Create a factor from site frequency 
  mutate(site_frequency = factor(site_frequency, levels = c('high', 'medium', 'low')),
         scenario = "Scenario 2") %>% 
  mutate(scenario = factor(scenario, levels = c("Scenario 1", "Scenario 2", "Scenario 3"))) %>% 
  rename(x=lon_bin,
         y=lat_bin)

scenario3_dives <- scenario3 %>% 
  filter(mpa_definition == "Marine Reserve") %>% 
  # Create a factor from site frequency 
  mutate(site_frequency = factor(site_frequency, levels = c('high', 'medium', 'low')),
         scenario = "Scenario 3") %>% 
  mutate(scenario = factor(scenario, levels = c("Scenario 1", "Scenario 2", "Scenario 3"))) %>% 
  rename(x=lon_bin,
         y=lat_bin)  

## Colors
# pal <- c('slategray3', 'tomato', 'darkcyan', 'firebrick')
# mpa_pal <- colorFactor(pal, mpa_shp$mpa_type) 
# 
# # Dive Site Frequency
# freq_pal <- hcl.colors(n=3, palette = "Heat")
# frequency_pal <- colorFactor(freq_pal, north_sites$site_frequency)
# 
# # Scenario palette 
# scen_pal <- c("#F6955EFF", "#9B6981FF", "#7887A4FF")
# 
# scen1_pal <- colorFactor(scen_pal, scenario1_dives$scenario)
# scen2_pal <- colorFactor(scen_pal, scenario2_dives$scenario)
# scen3_pal <- colorFactor(scen_pal, scenario3_dives$scenario)

# ship_pal <- c(paletteer_d('nationalparkcolors::Arches', 5), paletteer_d('nationalparkcolors::CraterLake', 3), 
#                    "#376597FF", "#E8C533FF", "#979461FF", "#CD5733FF", "#A12A19FF")
# shipname_pal <- colorFactor(ship_pal, north_dives$shipname)

## Map
# interactive_map <- leaflet() %>%
#   addProviderTiles(providers$Esri.WorldGrayCanvas) %>%
#   addPolygons(data=mpa_shp,
#               smoothFactor = 0.5,
#               opacity = 1,
#               weight = 1,
#               color = "grey60",
#               fillColor = NA,
#               group = "mpa_outline") %>% 
#   addPolygons(data=mpa_shp,
#               smoothFactor = 0.5,
#               opacity = 1,
#               weight = 1,
#               color = ~mpa_pal(mpa_type),
#               fillColor = ~mpa_pal(mpa_type),
#               fillOpacity = 0.6,
#               group = "mpa_type",
#               label = paste("Name:", mpa_shp$name)) %>% 
#   addCircleMarkers(data=north_sites,
#                    lng = north_sites$x,
#                    lat = north_sites$y,
#                    radius = 5,
#                    color = ~frequency_pal(site_frequency),
#                    fillColor = ~frequency_pal(site_frequency),
#                    stroke = FALSE,
#                    fillOpacity = 1,
#                    group = "dive_sites",
#                    clusterOptions = markerClusterOptions()) %>%
#   addCircleMarkers(data=scenario1_dives,
#                    lng = scenario1_dives$x,
#                    lat = scenario1_dives$y,
#                    radius = 5,
#                    color = ~scen1_pal(scenario),
#                    fillColor = ~scen1_pal(scenario),
#                    stroke = FALSE,
#                    fillOpacity = 1,
#                    group = "scenario1",
#                    label = paste("Scenario 1", "<br>", 
#                                  "Date:", scenario1_dives$date, "<br>",
#                                  "Time of Day:", scenario1_dives$time_of_day) %>%
#                      lapply(htmltools::HTML),
#                    clusterOptions = markerClusterOptions()) %>%
#   addCircleMarkers(data=scenario2_dives,
#                    lng = scenario2_dives$x,
#                    lat = scenario2_dives$y,
#                    radius = 5,
#                    color = ~scen2_pal(scenario),
#                    fillColor = ~scen2_pal(scenario),
#                    stroke = FALSE,
#                    fillOpacity = 1,
#                    group = "scenario2",
#                    label = paste("Scenario 2", "<br>", 
#                                  "Date:", scenario2_dives$date, "<br>",
#                                  "Time of Day:", scenario2_dives$time_of_day) %>%
#                      lapply(htmltools::HTML),
#                    clusterOptions = markerClusterOptions()) %>%
#   addCircleMarkers(data=scenario3_dives,
#                    lng = scenario3_dives$x,
#                    lat = scenario3_dives$y,
#                    radius = 5,
#                    color = ~scen3_pal(scenario),
#                    fillColor = ~scen3_pal(scenario),
#                    stroke = FALSE,
#                    fillOpacity = 1,
#                    group = "scenario3",
#                    label = paste("Scenario 3", "<br>", 
#                                  "Date:", scenario3_dives$date, "<br>",
#                                  "Time of Day:", scenario3_dives$time_of_day) %>%
#                      lapply(htmltools::HTML),
#                    clusterOptions = markerClusterOptions()) %>%
#   addLegend("bottomright",
#             pal = mpa_pal,
#             values = mpa_shp$mpa_type,
#             title = "MPA Type",
#             opacity = 1,
#             group = "mpa_type") %>% 
#   addLegend("bottomleft",
#             pal = frequency_pal,
#             values = north_sites$site_frequency,
#             title = "Site Frequency",
#             opacity = 1,
#             group = "dive_sites") %>%
#   addLegend("bottomleft",
#             pal = scen1_pal,
#             values = scenario1_dives$scenario,
#             title = "",
#             opacity = 1,
#             group = "scenario1") %>% 
#   addLegend("bottomleft",
#             pal = scen2_pal,
#             values = scenario2_dives$scenario,
#             title = "",
#             opacity = 1,
#             group = "scenario2") %>% 
#   addLegend("bottomleft",
#             pal = scen3_pal,
#             values = scenario3_dives$scenario,
#             title = "",
#             opacity = 1,
#             group = "scenario3") %>% 
#   addLayersControl(baseGroups = c("mpa_outline"), 
#                    overlayGroups = c("mpa_type", "dive_sites", "scenario1", "scenario2", "scenario3"),
#                    options = layersControlOptions(collapsed = FALSE)) %>% 
#   hideGroup("mpa_type") %>% 
#   hideGroup("dive_sites") %>% 
#   hideGroup("scenario1") %>% 
#   hideGroup("scenario2") %>% 
#   hideGroup("scenario3")
# 
# interactive_map
```

## Exploratory 

The following are just a few quick exploratory plots on the AIS identified dives. 

### Core Sites

The first plot compares the number of dives at high frequency, medium frequency, and low frequency sites for each of the three scenarios. High frequency are sites with the top 25% of visits (aggregated across all vessels and years), sites with more than 3 visits are considered "high frequency" and there are 222 high frequency sites. Medium frequency sites are the next 25% of visits, sites with more than one visit and 3 or less visits are considered "medium" frequency. There are 257 medium frequency sites. The remaining 518 sites, were only visited once and are considered low frequency sites. 

The second plot looks at the proportion of sites by site frequency within each MPA classification (i.e., proportion of high frequency sites located within MPAs, in MPA buffers, or outside of MPAs). 

Finally, we compare the number of dives by MPA classification for high frequency dive sites.    
\newpage

#### Scenario 1
$\\$    
All daytime dives: Time spent at dive sites is between 1.5 - 5 hours; the first AIS timestamp within the site is between 6 am - 6 pm   
$\\$ 
```{r core-sites-scen1, message=F, warning=F, echo=F,  dev='pdf', fig.align='center', fig.height=4, fig.width=6}
freq_pal <- hcl.colors(n=3, palette = "Heat")

scen1_dives_frequency <- scenario1_dives %>% 
  group_by(year, site_frequency) %>% 
  dplyr::summarize(n_dives = n()) %>% 
  ungroup() %>% 
  group_by(year) %>% 
  mutate(total_annual_dives = sum(n_dives)) %>% 
  ungroup() %>% 
  mutate(prop_dives = n_dives / total_annual_dives)

scen1_dive_frequency_plot <- ggplot(data=scen1_dives_frequency) + 
  geom_col(aes(x=year, y=n_dives, fill=site_frequency)) + 
  scale_x_continuous(expand = c(0,0),
                     breaks = seq(2016,2022,1)) + 
  scale_y_continuous(expand = c(0,0)) + 
  scale_fill_manual(values = freq_pal,
                    labels = c("High", "Medium", "Low")) + 
  labs(x="Year", 
       y="Number of Dives",
       fill="Site Frequency") + 
  theme_bw()

scen1_dive_frequency_plot
```

$\\$    
58 -76 % of the dives in each year are done at one of the 222 high frequency sites. The proportion of dives at frequency sites are lower in 2020-2022 (58-65%) than previous years (72-76%).  
$\\$  

```{r mpa-classification-core-sites-scen1, message=F, warning=F, echo=F,  dev='pdf', fig.align='center', fig.height=4, fig.width=6}
scen1_site_mpa_frequency <- scenario1 %>% 
  dplyr::select(mpa_definition, site_id, site_category, site_frequency) %>% 
  distinct() %>% 
  group_by(mpa_definition, site_frequency) %>% 
  mutate(total_sites_in_frequency = n()) %>% 
  ungroup() %>% 
  group_by(mpa_definition, site_frequency, site_category, total_sites_in_frequency) %>% 
  count() %>% 
  mutate(prop_category = n / total_sites_in_frequency)

scen1_site_mpa_plot <- ggplot(scen1_site_mpa_frequency) + 
  geom_col(aes(x=factor(site_frequency, levels = c('low', 'medium', 'high')), y=prop_category, fill=site_category)) + 
  scale_x_discrete(expand = c(0,0),
                   labels = c("Low", "Medium", "High")) + 
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,1)) + 
  scale_fill_manual(values = c("#F4E7C5FF", "#979461FF", "#CD5733FF"),
                    labels = c("In Buffer", "In MPA", "Outside MPA")) + 
  labs(x="Site Frequency",
       y="Proportion of Sites",
       fill = "Site Category") + 
  theme_bw() + 
  facet_wrap(~mpa_definition)

scen1_site_mpa_plot
```

$\\$ 
While a majority of the dive sites in each site frequency group (High, Medium, Low) are classified as being outside of MPAs, there is a larger proportion of the medium frequency and high frequency sites within MPAs compared to low frequency sites. This trend is more pronounced when looking at the combined Marine Reserve and Conservation Area definition of "MPA", but is still true when looking only at Marine Reserves as well. 
$\\$  

```{r dives-mpa-and-frequency-scen1, message=F, warning=F, echo=F, dev='pdf', fig.align='center', fig.height=4, fig.width=8}
scen1_dives_mpa_frequency <- scenario1 %>% 
  filter(site_frequency == "high") %>% 
  group_by(mpa_definition, year) %>% 
  mutate(total_dives_year = n()) %>% 
  ungroup() %>% 
  group_by(mpa_definition, year, site_category, total_dives_year) %>% 
  summarize(n_dives = n()) %>% 
  ungroup() %>% 
  mutate(prop_dives = n_dives / total_dives_year)

scen1_dive_mpa_plot <- ggplot(scen1_dives_mpa_frequency) + 
  geom_col(aes(x=year, y=prop_dives, fill=site_category)) +
  scale_x_continuous(expand = c(0,0),
                     breaks = seq(2016,2022,1)) + 
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,1)) + 
  scale_fill_manual(values = c("#F4E7C5FF", "#979461FF", "#CD5733FF"),
                    labels = c("In Buffer", "In MPA", "Outside MPA")) + 
  labs(x="Year",
       y="Proportion of Dives",
       fill = "Site Category") + 
  theme_bw() + 
  facet_wrap(~mpa_definition)

scen1_dive_mpa_plot
```
$\\$ 

Approximately 23% of high frequency sites fall within Marine Reserve areas. We might expect that if all high frequency sites were visited equally then about 23% of the dives in a given year at these high frequency sites would fall within an MPA. Somewhere between 28-36% of the dives in each year across high frequency sites are at sites within a Marine Reserve. When considering MPAs as Marine Reserves and Conservation Areas, ~38% of the high frequency sites are within MPAs and somewhere between 44 and 59% of the dives in each year across high frequency sites are at sites within a Marine Reserve or Conservation Area. This seems like a good signal for a more rigorous statistical evaluation of dive site preference. 
$\\$ 

#### Scenario 2
$\\$   
Daytime without October: Further filters the scenario 1 dataset to remove any dives in the month of October (start of lobster season)    
$\\$ 
```{r core-sites-scen2, message=F, warning=F, echo=F, dev='pdf', fig.align='center', fig.height=4, fig.width=6}
scen2_dives_frequency <- scenario2_dives %>% 
  group_by(year, site_frequency) %>% 
  dplyr::summarize(n_dives = n()) %>% 
  ungroup() %>% 
  group_by(year) %>% 
  mutate(total_annual_dives = sum(n_dives)) %>% 
  ungroup() %>% 
  mutate(prop_dives = n_dives / total_annual_dives)

scen2_dive_frequency_plot <- ggplot(data=scen2_dives_frequency) + 
  geom_col(aes(x=year, y=n_dives, fill=site_frequency)) + 
  scale_x_continuous(expand = c(0,0),
                     breaks = seq(2016,2022,1)) + 
  scale_y_continuous(expand = c(0,0)) + 
  scale_fill_manual(values = freq_pal,
                    labels = c("High", "Medium", "Low")) + 
  labs(x="Year", 
       y="Number of Dives",
       fill="Site Frequency") + 
  theme_bw()

scen2_dive_frequency_plot
```
$\\$    
In this scenario it's more like 60-80% of the dives occur at one of the high frequency sites. The trend is similar to scenario 1 where the proportion of dives at high frequency sites is lower in the later years compared to the earlier years. 
$\\$  

```{r mpa-classification-core-sites-scen2, message=F, warning=F, echo=F, dev='pdf', fig.align='center', fig.height=4, fig.width=6}
scen2_site_mpa_frequency <- scenario2 %>% 
  dplyr::select(mpa_definition, site_id, site_category, site_frequency) %>% 
  distinct() %>% 
  group_by(mpa_definition, site_frequency) %>% 
  mutate(total_sites_in_frequency = n()) %>% 
  ungroup() %>% 
  group_by(mpa_definition, site_frequency, site_category, total_sites_in_frequency) %>% 
  count() %>% 
  mutate(prop_category = n / total_sites_in_frequency)

scen2_site_mpa_plot <- ggplot(scen2_site_mpa_frequency) + 
  geom_col(aes(x=factor(site_frequency, levels = c('low', 'medium', 'high')), y=prop_category, fill=site_category)) + 
  scale_x_discrete(expand = c(0,0),
                   labels = c("Low", "Medium", "High")) + 
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,1)) + 
  scale_fill_manual(values = c("#F4E7C5FF", "#979461FF", "#CD5733FF"),
                    labels = c("In Buffer", "In MPA", "Outside MPA")) + 
  labs(x="Site Frequency",
       y="Proportion of Sites",
       fill = "Site Category") + 
  theme_bw() + 
  facet_wrap(~mpa_definition)

scen2_site_mpa_plot
```

$\\$ 
In this scenario, the trend identified in Scenario 1 (larger proportion of the medium frequency and high frequency sites within MPAs compared to low frequency sites), is still true when looking at Marine Reserves and Conservation Areas. While there are more MPAs in high frequency sites in the Marine Reserves only scenario, this is not the case for medium frequency sites.   
$\\$  

```{r dives-mpa-and-frequency-scen2, message=F, warning=F, echo=F, dev='pdf', fig.align='center', fig.height=4, fig.width=8}
scen2_dives_mpa_frequency <- scenario2 %>% 
  filter(site_frequency == "high") %>% 
  group_by(mpa_definition, year) %>% 
  mutate(total_dives_year = n()) %>% 
  ungroup() %>% 
  group_by(mpa_definition, year, site_category, total_dives_year) %>% 
  summarize(n_dives = n()) %>% 
  ungroup() %>% 
  mutate(prop_dives = n_dives / total_dives_year)

scen2_dive_mpa_plot <- ggplot(scen2_dives_mpa_frequency) + 
  geom_col(aes(x=year, y=prop_dives, fill=site_category)) +
  scale_x_continuous(expand = c(0,0),
                     breaks = seq(2016,2022,1)) + 
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,1)) + 
  scale_fill_manual(values = c("#F4E7C5FF", "#979461FF", "#CD5733FF"),
                    labels = c("In Buffer", "In MPA", "Outside MPA")) + 
  labs(x="Year",
       y="Proportion of Dives",
       fill = "Site Category") + 
  theme_bw() + 
  facet_wrap(~mpa_definition)

scen2_dive_mpa_plot
```
$\\$  
The same trends identified in Scenario 1 apply here, though slightly less dives are done in MPAs in this subset since we filter out data for October, the start of lobster season.     
$\\$   

#### Scenario 3
$\\$   
Daytime without lobster season: Further filters the scenario 1 to remove any dives during lobster season
$\\$   
```{r core-sites-scen3, message=F, warning=F, echo=F, dev='pdf', fig.align='center', fig.height=4, fig.width=6}
scen3_dives_frequency <- scenario3_dives %>% 
  group_by(year, site_frequency) %>% 
  dplyr::summarize(n_dives = n()) %>% 
  ungroup() %>% 
  group_by(year) %>% 
  mutate(total_annual_dives = sum(n_dives)) %>% 
  ungroup() %>% 
  mutate(prop_dives = n_dives / total_annual_dives)

scen3_dive_frequency_plot <- ggplot(data=scen3_dives_frequency) + 
  geom_col(aes(x=year, y=n_dives, fill=site_frequency)) + 
  scale_x_continuous(expand = c(0,0),
                     breaks = seq(2016,2022,1)) + 
  scale_y_continuous(expand = c(0,0)) + 
  scale_fill_manual(values = freq_pal,
                    labels = c("High", "Medium", "Low")) + 
  labs(x="Year", 
       y="Number of Dives",
       fill="Site Frequency") + 
  theme_bw()

scen3_dive_frequency_plot
```
$\\$    
This scenario is similar to Scenario 2, with 63-83% of the dives occur at one of the high frequency sites. The trend is similar to the other two where the proportion of dives at high frequency sites is lower in the later years compared to the earlier years. 

```{r mpa-classification-core-sites-scen3, message=F, warning=F, echo=F, dev='pdf', fig.align='center', fig.height=4, fig.width=6}
scen3_site_mpa_frequency <- scenario3 %>% 
  dplyr::select(mpa_definition, site_id, site_category, site_frequency) %>% 
  distinct() %>% 
  group_by(mpa_definition, site_frequency) %>% 
  mutate(total_sites_in_frequency = n()) %>% 
  ungroup() %>% 
  group_by(mpa_definition, site_frequency, site_category, total_sites_in_frequency) %>% 
  count() %>% 
  mutate(prop_category = n / total_sites_in_frequency)

scen3_site_mpa_plot <- ggplot(scen3_site_mpa_frequency) + 
  geom_col(aes(x=factor(site_frequency, levels = c('low', 'medium', 'high')), y=prop_category, fill=site_category)) + 
  scale_x_discrete(expand = c(0,0),
                   labels = c("Low", "Medium", "High")) + 
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,1)) + 
  scale_fill_manual(values = c("#F4E7C5FF", "#979461FF", "#CD5733FF"),
                    labels = c("In Buffer", "In MPA", "Outside MPA")) + 
  labs(x="Site Frequency",
       y="Proportion of Sites",
       fill = "Site Category") + 
  theme_bw() + 
  facet_wrap(~mpa_definition)

scen3_site_mpa_plot
```
$\\$ 
This scenario is similar to scenario 2. The trend of a larger proportion of the medium frequency and high frequency sites within MPAs compared to low frequency sites is still true when looking at Marine Reserves and Conservation Areas, but is only true for high frequency in the Marine Reserves. 
$\\$ 
```{r dives-mpa-and-frequency-scen3, message=F, warning=F, echo=F, dev='pdf', fig.align='center', fig.height=4, fig.width=8}
scen3_dives_mpa_frequency <- scenario3 %>% 
  filter(site_frequency == "high") %>% 
  group_by(mpa_definition, year) %>% 
  mutate(total_dives_year = n()) %>% 
  ungroup() %>% 
  group_by(mpa_definition, year, site_category, total_dives_year) %>% 
  summarize(n_dives = n()) %>% 
  ungroup() %>% 
  mutate(prop_dives = n_dives / total_dives_year)

scen3_dive_mpa_plot <- ggplot(scen3_dives_mpa_frequency) + 
  geom_col(aes(x=year, y=prop_dives, fill=site_category)) +
  scale_x_continuous(expand = c(0,0),
                     breaks = seq(2016,2022,1)) + 
  scale_y_continuous(expand = c(0,0),
                     limits = c(0,1)) + 
  scale_fill_manual(values = c("#F4E7C5FF", "#979461FF", "#CD5733FF"),
                    labels = c("In Buffer", "In MPA", "Outside MPA")) + 
  labs(x="Year",
       y="Proportion of Dives",
       fill = "Site Category") + 
  theme_bw() + 
  facet_wrap(~mpa_definition)

scen3_dive_mpa_plot
```
$\\$ 
Again, the same trends identified in Scenario 1 apply here. In this scenario we removed all lobster season data, roughly October to mid-March, and we expect then a higher proportion of these data would be at sites within an MPA. Looking at Marine Reserves we see approximately 28-43% of dives at high frequency sites occurred at sites within an MPA compared to 27-36% of dives from Scenario 1.  

